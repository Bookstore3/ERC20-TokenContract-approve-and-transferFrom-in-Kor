# 1장
### ERC20 approve() 및 transferFrom() 정리
---

ERC20 토큰에는 A라는 계정이 B라는 계정에게 본인이 가지고 있던 토큰을 전송하는 transfer()이라는 함수가 있다.
그러나 토큰 전송 방식에는 이와는 조금 다른 방식이 있다.

바로 approve()와 transferFrom()을 활용하는 방식이다.

이는 A라는 계정이 B에게 본인 계정에서 특정 양 만큼의 토큰을 가져갈 수 있게 허락을 해주고, B는 A가 허락해준 토큰 양만큼 토큰을 본인이 원할 때 인출해 갈 수 있는 방식이다.

그럼 여기서 approve()와 transferFrom()을 설명하기 전에 간단히 스마트 컨트랙트의 토큰에 대해 알아보고 가자.

스마트 컨트랙트의 토큰이란 간단히 스마트 컨트랙트의 mapping 구조체에 묶여있는 숫자이다.
조금 더 자세히 말하자면 **토큰을 가지고 있는 계정** 과 그 계정에 할당되어 있는 **토큰의 양** 이 mapping으로 기록되어 있는 것이다.

~~~
mapping (address => uint256) balances;
~~~

> mapping: 키와 값으로 쌍 지어져 기록이 되는 구조.
위에 balances에서는 address의 값을 키로 입력을 하면 그에 할당하는 코인의 갯수가 나온다.

그렇기 때문에 토큰은 스마트 컨트랙트를 사실상 벗어날 수 없는 구조다.
토큰 스마트 컨트랙트 안의 mapping에 기록된 숫자들이 변경이 될 뿐, 이더나 코인처럼 컨트랙트 또는 계정 사이를 자유롭게 이동할 수 있는 것이 아니다. 그럼 마이이더웰렛 같은 곳에서 지갑에 토큰을 넣어놓는 것은 무엇이냐 하겠지만 이는 토큰 주소를 통해 토큰에 mapping된 본인 계정의 주소를 가져와 관리를 하는 것 뿐이다.

이러한 구조 때문에 다른 컨트랙트에서 클라이언트로부터 서비스에 대한 비용을 이더와 같은 코인이 아닌 토큰으로 받으려 하면 단순히 sendTransaction() 함수를 이용해서 보낼 수 없다.
이를 위해서는 approve()와 transferFrom()을 사용해야 한다.

아래는 approve()와 transferFrom()의 상호 작용을 현실 세계에 적용해 나타낸 그림이다.

![TACT_001](images/TCAT_001.png)

A와 B라는 친구가 있다.
이 둘은 각각 LA와 New York이라는 거리가 먼 곳에 떨어져 산다.

![TACT_002](images/TCAT_002.png)

그리고 이 A라는 친구에게는 은행이 A의 이름으로 보관하고 있는 100$라는 돈이 있었다.

![TACT_003](images/TCAT_003.png)

어느날 돈이 대략 50$ 정도가 필요했던 B가 A에게 돈을 빌려줄 수 있냐고 부탁을 했다.
이에 A는 흔쾌히 그렇게 하라고 했다.

그러나 이 둘은 멀리 떨어져 살아서 돈을 직접 줄 수 없었다.

![TACT_004](images/TCAT_004.png)

그래서 A가 은행에 연락을 해서 B라는 사람이 내 친구인데 내 이름을 대고 돈을 달라고 하면 최대 50$까지 주세요 라고 연락을 했다.

![TACT_005](images/TCAT_005.png)

그리고 B에게 최대 50$까지 돈을 빌려 갈 수 있게 은행에 연락을 해 놨으니 은행에게 내 이름을 대고 돈을 빌리라고 말을 해 줬다.

B는 이에 은행에 가서 A의 이름을 대고 지금 당장 필요한 30$ 정도만 돈을 본인 계정이 넣어달라고 요청을 했고, 이에 은행은 B의 계정에 30$를 넣고 A의 계정을 30$가 깍인 70$로 수정을 했다. 그리고 A가 정해놓은 한도 50$에서도 30$가 깍인 20$ 한도로 수정을 했다.

위에 그림들은 approve()와 transferFrom()의 관계를 현실에 비유해서 나타낸 그림이다.
물론 현실 은행에서는 A가 B의 계좌로 바로 돈을 보내주면 되지만 지금 우리는 코인이 아닌 토큰의 경우를 설명하고 있으니 감안해 주길 바란다.

다음 장에서는 실제 코드에서 진행되는 과정을 그림과 함께 설명을 할 것이다.
